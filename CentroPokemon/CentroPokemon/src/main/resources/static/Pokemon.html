<!DOCTYPE html>
<!--
@file        Pokemon.html
@summary     P√°gina ‚ÄúIndex‚Äù do Centro Pok√©mon
@description Landing page com header padr√£o, se√ß√µes de boas-vindas,
             estat√≠sticas, destaque do dia, a√ß√µes r√°pidas, not√≠cias,
             equipe m√©dica e oferta.
@css         /css/novo-style.css
@js          /js/animacoes.js (navega entre se√ß√µes por √¢ncoras e pathname)
-->
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro Pok√©mon - P√°gina B√°sica</title>
    <link rel="stylesheet" href="/css/novo-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <!--
    @section    Header
    @purpose    Cabe√ßalho fixo com navega√ß√£o principal
@links      In√≠cio (/), Pok√©dex (/pokedex), Centro de Cura (/centro), Sobre (/sobre)
    -->
    <header>
        <div class="auth-links auth-top-right">
            <a href="/cadastro.html">Cadastro</a>
            <a href="/login.html">Login</a>
        </div>
        <div class="header-content header-stacked">
            <h1>Centro Pok√©mon</h1>
            <nav>
                <ul>
                    <li><a href="/Pokemon.html" class="active">In√≠cio</a></li>
                    <li><a href="/pokedex">Pok√©dex</a></li>
                    <li><a href="/centro">Centro de Cura</a></li>
                    <li><a href="/sobre">Sobre</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    
    
    

    <!-- CONTE√öDO PRINCIPAL -->
    <main>
        <!--
        @section    P√°gina Inicial
        @purpose    Painel com boas-vindas e m√≥dulos informativos
        @modules    Boas-vindas, Estat√≠sticas, Destaque do dia, A√ß√µes r√°pidas,
                    Not√≠cias, Equipe, Oferta
        @routing    "/" mostra #inicio; "/centro" mostra #centro; "/sobre" mostra #sobre
        -->
        <div class="pagina ativa" id="inicio">
            <h2>Bem-vindo ao Centro Pok√©mon</h2>
            
            <div class="pagina-content">
                <!--
                @block      Boas-vindas
                @purpose    Mensagem introdut√≥ria ao usu√°rio
                -->
                <div class="welcome-message">
                    <p>Ol√°, Treinador! Este √© o Centro Pok√©mon, onde seus companheiros recebem os melhores cuidados.</p>
                </div>

                <!--
                @block      Estat√≠sticas do Centro
                @data       Quantidades agregadas (curados, atendidos, esp√©cies)
                -->
                <div class="stats-container">
                    <div class="stat-card">
                        <span class="stat-number">1,234</span>
                        <span class="stat-label">Pok√©mon Curados</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">567</span>
                        <span class="stat-label">Treinadores Atendidos</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">89</span>
                        <span class="stat-label">Esp√©cies Diferentes</span>
                    </div>
                </div>

                <!--
                @block      Pok√©mon em Destaque
                @purpose    Mostra o destaque do dia com sprite e dados resumidos
                -->
                <div class="pokemon-destaque">
                    <div class="destaque-content">
                        <div class="destaque-info">
                            <h4>Pikachu</h4>
                            <p>N√≠vel: 25</p>
                            <p>Tipo: El√©trico</p>
                            <p>HP: 72/72</p>
                        </div>
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png" 
                             alt="Pikachu" class="destaque-sprite">
                    </div>
                </div>

                <!--
                @block      A√ß√µes R√°pidas
                @purpose    Bot√µes de navega√ß√£o/a√ß√£o principais do site
                -->
                <div class="quick-actions">
                    <button class="quick-btn">
                        <span class="feature-icon">‚öïÔ∏è</span>
                        Curar Pok√©mon
                    </button>
                    <button class="quick-btn secondary">
                        <span class="feature-icon">üìã</span>
                        Ver Pok√©dex
                    </button>
                    <button class="quick-btn tertiary">
                        <span class="feature-icon">üë•</span>
                        Equipe M√©dica
                    </button>
                </div>

                <!--
                @block      Not√≠cias
                @purpose    Grid com not√≠cias recentes e datas
                -->
                <div class="news-container">
                    <h3>√öltimas Not√≠cias</h3>
                    <div class="news-grid">
                        <div class="news-item">
                            <h4>Novo Tratamento Dispon√≠vel</h4>
                            <p>Implementamos uma nova t√©cnica de cura para Pok√©mon do tipo Fogo.</p>
                            <span class="news-date">17/11/2024</span>
                        </div>
                        <div class="news-item">
                            <h4>Torneio da Liga</h4>
                            <p>Inscri√ß√µes abertas para o torneio regional. Prepare seus Pok√©mon!</p>
                            <span class="news-date">15/11/2024</span>
                        </div>
                    </div>
                </div>

                <!--
                @block      Equipe M√©dica
                @purpose    Lista a equipe com cargos e especialidades
                -->
                <div class="equipe-container">
                    <h3>Nossa Equipe</h3>
                    <div class="equipe-grid">
                        <div class="equipe-member">
                            <div class="equipe-avatar">üë®‚Äç‚öïÔ∏è</div>
                            <h4>Dr. Carvalho</h4>
                            <span class="cargo">M√©dico Chefe</span>
                            <p>Especialista em Pok√©mon do tipo Planta</p>
                        </div>
                        <div class="equipe-member">
                            <div class="equipe-avatar">üë©‚Äç‚öïÔ∏è</div>
                            <h4>Enf. Joy</h4>
                            <span class="cargo">Enfermeira</span>
                            <p>Cuidados gerais e primeiros socorros</p>
                        </div>
                    </div>
                </div>

                <!--
                @block      Timer de Oferta
                @purpose    Elemento promocional com anima√ß√£o simples
                -->
                <div class="oferta-timer">
                    <h4>OFERTA ESPECIAL!</h4>
                    <div class="timer-display">02:15:33</div>
                    <p>Cura gratuita para Pok√©mon do tipo √Ågua</p>
                </div>
            </div>
        </div>
    </main>
    <div class="pagina" id="centro">
        <h2>Centro de Cura</h2>
        <div class="pagina-content">
            <div class="agendamento-container">
                <div class="agendamento-form-card">
                    <h3>Agendar Consulta</h3>
                    <form id="agendar-consulta-form">
                        <div class="form-row">
                            <label for="pokemon-select">Pok√©mon</label>
                            <select id="pokemon-select" required></select>
                        </div>
                        <div class="form-row">
                            <label for="tipo-consulta">Tipo</label>
                            <select id="tipo-consulta" required>
                                <option value="CONSULTA">Consulta</option>
                                <option value="VACINACAO">Vacina√ß√£o</option>
                                <option value="CHECKUP">Check-up</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label for="datahora-consulta">Data e Hora</label>
                            <input id="datahora-consulta" type="datetime-local" required />
                        </div>
                        <div class="form-row">
                            <label for="obs-consulta">Observa√ß√µes</label>
                            <textarea id="obs-consulta" rows="3" placeholder="Opcional"></textarea>
                        </div>
                        <div class="agendar-actions">
                            <button type="submit" class="btn primary">Agendar</button>
                            <a href="#consultas-list" class="btn secondary">Ver agendamentos</a>
                        </div>
                        <div id="agendar-alert" class="alert" role="alert"></div>
                    </form>
                </div>

                <div class="agendadas-card" id="consultas-list">
                    <h3>Consultas Agendadas</h3>
                    <div class="consultas-grid" id="consultas-grid"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="pagina" id="sobre">
        <h2>Sobre o Centro Pok√©mon</h2>
        <div class="welcome-message">
            <img src="/imagens/sobre.png" alt="Sobre o Centro Pok√©mon">
            <p>O Centro Pok√©mon oferece cuidados completos aos seus parceiros, com equipe dedicada e tecnologia de ponta.</p>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2024 Centro Pok√©mon. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- @scripts   JavaScript externo para anima√ß√µes -->
    <script src="/js/animacoes.js"></script>
    <script>
        const API_BASE_TREINADORES = '/CentroPokemon/api/treinadores';
        const TRAINER_ID_KEY = 'treinador_id';
        const trainerId = localStorage.getItem(TRAINER_ID_KEY);
        const pokemonSelect = document.getElementById('pokemon-select');
        const consultasGrid = document.getElementById('consultas-grid');
        const alertBox = document.getElementById('agendar-alert');

        function setAlert(type, text) {
            alertBox.className = 'alert';
            alertBox.textContent = '';
            if (!text) return;
            alertBox.classList.add(type);
            alertBox.textContent = text;
        }

        async function fetchJson(url, init) {
            const res = await fetch(url, init);
            if (!res.ok) throw new Error(String(res.status));
            return res.json();
        }

        async function carregarPokemons() {
            if (!trainerId) {
                pokemonSelect.innerHTML = '<option value="">Fa√ßa login para agendar</option>';
                pokemonSelect.disabled = true;
                setAlert('error', 'Fa√ßa login para agendar consultas.');
                return;
            }
            const lista = await fetchJson(`${API_BASE_TREINADORES}/${trainerId}/pokemons`);
            pokemonSelect.innerHTML = '';
            for (const p of lista) {
                const opt = document.createElement('option');
                opt.value = String(p.id);
                opt.textContent = `${p.nomePt} (#${p.pokeApiId || p.id})`;
                pokemonSelect.appendChild(opt);
            }
        }

        function renderConsultas(consultas) {
            consultasGrid.innerHTML = '';
            if (!consultas || consultas.length === 0) {
                consultasGrid.innerHTML = '<div class="empty">Nenhuma consulta agendada.</div>';
                return;
            }
            for (const c of consultas) {
                const card = document.createElement('div');
                card.className = 'consulta-item';
                const dt = new Date(c.dataHora);
                const dtStr = dt.toLocaleString('pt-BR');
                card.innerHTML = `
                    <div class="consulta-header">
                        <span class="consulta-tipo">${c.tipo}</span>
                        <span class="consulta-data">${dtStr}</span>
                    </div>
                    <div class="consulta-body">
                        <div class="consulta-pokemon">
                            <img src="${c.pokemonSpriteUrl}" alt="${c.pokemonNome}" />
                            <span>${c.pokemonNome}</span>
                        </div>
                        ${c.observacoes ? `<div class="consulta-obs">${c.observacoes}</div>` : ''}
                    </div>
                `;
                consultasGrid.appendChild(card);
            }
        }

        async function carregarConsultas() {
            if (!trainerId) return;
            const lista = await fetchJson(`${API_BASE_TREINADORES}/${trainerId}/consultas`);
            renderConsultas(lista);
        }

        async function handleAgendar(e) {
            e.preventDefault();
            if (!trainerId) {
                setAlert('error', 'Fa√ßa login para agendar consultas.');
                return;
            }
            const pokemonId = Number(pokemonSelect.value);
            const tipo = document.getElementById('tipo-consulta').value;
            const dataHoraStr = document.getElementById('datahora-consulta').value;
            const observacoes = document.getElementById('obs-consulta').value;
            if (!pokemonId || !tipo || !dataHoraStr) {
                setAlert('error', 'Preencha Pok√©mon, Tipo e Data/Hora.');
                return;
            }
            const body = { pokemonId, tipo, dataHora: dataHoraStr, observacoes };
            try {
                await fetchJson(`${API_BASE_TREINADORES}/${trainerId}/consultas`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)
                });
                setAlert('success', 'Consulta agendada com sucesso.');
                await carregarConsultas();
            } catch (err) {
                setAlert('error', 'N√£o foi poss√≠vel agendar.');
            }
        }

        document.getElementById('agendar-consulta-form').addEventListener('submit', handleAgendar);
        carregarPokemons().then(carregarConsultas).catch(() => {});
    </script>
</body>
</html>