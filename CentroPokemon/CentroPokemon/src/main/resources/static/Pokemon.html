<!DOCTYPE html>
<!--
@file        Pokemon.html
@summary     P√°gina ‚ÄúIndex‚Äù do Centro Pok√©mon
@description Landing page com header padr√£o, se√ß√µes de boas-vindas,
             estat√≠sticas, destaque do dia, a√ß√µes r√°pidas, not√≠cias,
             equipe m√©dica e oferta.
@css         /css/novo-style.css
@js          /js/animacoes.js (navega entre se√ß√µes por √¢ncoras e pathname)
-->
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro Pok√©mon - P√°gina B√°sica</title>
    <link rel="stylesheet" href="/css/novo-style.css">
    <link rel="stylesheet" href="/css/centro-cura.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <!--
    @section    Header
    @purpose    Cabe√ßalho fixo com navega√ß√£o principal
@links      In√≠cio (/), Pok√©dex (/pokedex), Centro de Cura (/centro), Sobre (/sobre)
    -->
    <header>
        <div class="auth-links auth-top-right">
            <a href="/cadastro.html">Cadastro</a>
            <a href="/login.html">Login</a>
        </div>
        <div class="header-content header-stacked">
            <h1>Centro Pok√©mon</h1>
            <nav>
                <ul>
                    <li><a href="/Pokemon.html#inicio" class="active">In√≠cio</a></li>
                    <li><a href="/pokedex">Pok√©dex</a></li>
                    <li><a href="/Pokemon.html#centro">Centro de Cura</a></li>
                    <li><a href="/Pokemon.html#sobre">Sobre</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    
    
    

    <!-- CONTE√öDO PRINCIPAL -->
    <main>
        <div class="pagina ativa" id="inicio">
            <div class="pagina-content">
                <div class="classic-layout">
                    <aside class="sidebar">
                        <div class="sidebar-section">
                            <h4>Menu R√°pido</h4>
                            <div class="sidebar-menu">
                                <a href="/centro#centro" class="sidebar-btn"><span class="menu-icon">üè•</span><span>Agendar Consulta</span></a>
                                <a href="/pokedex" class="sidebar-btn"><span class="menu-icon">üìì</span><span>Ver Pok√©dex</span></a>
                                <a href="/sobre#sobre" class="sidebar-btn"><span class="menu-icon">üßë‚Äç‚öïÔ∏è</span><span>Falar com Especialista</span></a>
                            </div>
                        </div>
                        <div class="sidebar-section">
                            <h4>Estat√≠sticas</h4>
                            <div class="stats-bubble"><span class="stat-number">98%</span><span class="stat-label">Taxa de recupera√ß√£o</span></div>
                            <div class="stats-bubble"><span class="stat-number">15min</span><span class="stat-label">Tempo m√©dio de espera</span></div>
                            <div class="stats-bubble"><span class="stat-number">500+</span><span class="stat-label">Esp√©cies atendidas</span></div>
                        </div>
                        <div class="sidebar-section">
                            <h4>Destaque do dia</h4>
                            <div class="pokemon-destaque">
                                <img class="destaque-sprite" src="/imagens/pikachu-pokedex.png" alt="Pikachu">
                                <div class="destaque-info">
                                    <h5>Pikachu</h5>
                                    <p>Estado: Est√°vel</p>
                                    <div class="hp-bar"><div class="hp-fill" style="width:85%"></div></div>
                                    <small>ID: #0025</small>
                                </div>
                            </div>
                        </div>
                    </aside>
                    <div class="main-content">
                        <div class="welcome-banner">
                            <div class="banner-content">
                                <h3>Bem-vindo ao Centro M√©dico Pok√©mon</h3>
                                <p>Cuidados especializados 24/7 para seus parceiros</p>
                                <p>Agende consultas, acompanhe prontu√°rios e acesse protocolos de emerg√™ncia</p>
                            </div>
                            <img class="pikachu-welcome" src="/imagens/pikachu-pokedex.png" alt="Pikachu">
                        </div>
                        <section class="missoes-container">
                            <h4>Miss√µes do dia</h4>
                            <div class="missoes-grid">
                                <div class="missao-card">
                                    <span class="missao-icon">üìÖ</span>
                                    <h5>Agendar Check-up</h5>
                                    <p>Garanta o bem-estar do seu Pok√©mon</p>
                                    <div class="missao-progresso">
                                        <div class="progresso-bar"><div class="progresso-fill" style="width:40%"></div></div>
                                        <span>40%</span>
                                    </div>
                                </div>
                                <div class="missao-card">
                                    <span class="missao-icon">üíâ</span>
                                    <h5>Atualizar Vacina√ß√£o</h5>
                                    <p>Consulte o calend√°rio recomendado</p>
                                    <div class="missao-progresso">
                                        <div class="progresso-bar"><div class="progresso-fill" style="width:60%"></div></div>
                                        <span>60%</span>
                                    </div>
                                </div>
                                <div class="missao-card">
                                    <span class="missao-icon">üß™</span>
                                    <h5>Exames de Rotina</h5>
                                    <p>Agende exames preventivos</p>
                                    <div class="missao-progresso">
                                        <div class="progresso-bar"><div class="progresso-fill" style="width:20%"></div></div>
                                        <span>20%</span>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <div class="tv-container">
                            <h4>TV da Sala de Espera</h4>
                            <div class="tv-frame">
                                <div class="tv-screen">
                                    <video class="pokemon-video" controls muted playsinline>
                                        <source src="/videos/EP 001 - Pok√©mon Eu Escolho Voc√™!.mkv" type="video/x-matroska">
                                        Seu navegador n√£o suporta a reprodu√ß√£o de v√≠deo.
                                    </video>
                                </div>
                            </div>
                            <div class="tv-controls">
                                <p>Programa√ß√£o: EP 001 - Pok√©mon Eu Escolho Voc√™!</p>
                                <div class="tv-info"><span class="tv-channel">Canal Pok√©mon</span><span class="tv-time">Epis√≥dio Cl√°ssico</span></div>
                            </div>
                        </div>
                        <div class="medical-actions">
                            <a href="/centro#centro" class="btn primary"><span>üè•</span> Agendar Consulta</a>
                            <a href="/pokedex" class="btn secondary"><span>üìì</span> Ver Pok√©dex M√©dica</a>
                            <a href="/sobre#sobre" class="btn secondary"><span>üßë‚Äç‚öïÔ∏è</span> Falar com Especialista</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div class="pagina" id="centro">
        <h2>Centro de Cura</h2>
        <div class="pagina-content">
            <div class="centro-layout">
                <!-- Coluna Esquerda: Formul√°rio de Agendamento -->
                <div class="centro-left">
                    <div class="agendamento-form-card">
                        <h3>üìÖ Agendar Consulta</h3>
                        <form id="agendar-consulta-form">
                            <div class="form-row">
                                <label for="pokemon-select">Pok√©mon</label>
                                <select id="pokemon-select" required></select>
                            </div>
                            <div class="form-row">
                                <label for="tipo-consulta">Tipo</label>
                                <select id="tipo-consulta" required>
                                    <option value="CONSULTA">Consulta</option>
                                    <option value="VACINACAO">Vacina√ß√£o</option>
                                    <option value="CHECKUP">Check-up</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label for="datahora-consulta">Data e Hora</label>
                                <input id="datahora-consulta" type="datetime-local" required />
                            </div>
                            <div class="form-row">
                                <label for="obs-consulta">Observa√ß√µes</label>
                                <textarea id="obs-consulta" rows="3" placeholder="Opcional"></textarea>
                            </div>
                            <div class="agendar-actions">
                                <button type="submit" class="btn primary">Agendar</button>
                            </div>
                            <div id="agendar-alert" class="alert" role="alert"></div>
                        </form>
                    </div>
                </div>

                <!-- Coluna Direita: Consultas Agendadas + Cura R√°pida -->
                <div class="centro-right">
                    <!-- Consultas Agendadas -->
                    <div class="agendadas-card">
                        <h3>üìã Consultas Agendadas</h3>
                        <div class="consultas-grid" id="consultas-grid"></div>
                    </div>

                    <!-- Cura R√°pida -->
                    <div class="cura-rapida-section">
                        <h3>‚ö° Cura R√°pida</h3>
                        <p style="color: #666; margin-bottom: 1rem; font-size: 0.85rem;">Clique na barrinha de vida para curar instantaneamente!</p>
                        <div id="pokemon-cura-grid" class="pokemon-cura-grid"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="pagina" id="sobre">
        <h2>Sobre o Centro Pok√©mon</h2>
        
        <div class="sobre-hero">
            <img src="/imagens/sobre.png" alt="Centro Pok√©mon" class="sobre-imagem-destaque">
            <div class="sobre-texto-hero">
                <h3>Cuide dos seus parceiros com excel√™ncia!</h3>
                <p>O Centro Pok√©mon oferece cuidados completos aos seus parceiros, com equipe dedicada e tecnologia de ponta. Somos refer√™ncia em sa√∫de Pok√©mon em toda a regi√£o.</p>
            </div>
        </div>

        <div class="sobre-grid">
            <div class="sobre-card">
                <img src="/imagens/Professor-Oak-from-Poke - mon-Black-and-White.png" alt="Professor Carvalho" class="sobre-card-img">
                <h4>Equipe Especializada</h4>
                <p>Profissionais treinados pela Liga Pok√©mon com anos de experi√™ncia no cuidado de todas as esp√©cies.</p>
            </div>
            
            <div class="sobre-card">
                <img src="/imagens/Bag_Master_Ball_SV_Sprite.png" alt="Tecnologia Avan√ßada" class="sobre-card-img">
                <h4>Tecnologia de Ponta</h4>
                <p>Equipamentos modernos e tratamentos inovadores para garantir a sa√∫de do seu Pok√©mon.</p>
            </div>
            
            <div class="sobre-card">
                <img src="/imagens/rare-candy.png" alt="Tratamentos Especiais" class="sobre-card-img">
                <h4>Tratamentos Exclusivos</h4>
                <p>Desde curas b√°sicas at√© tratamentos especiais para Pok√©mon lend√°rios e raros.</p>
            </div>
        </div>

        <div class="sobre-autores">
            <h4>Desenvolvido com ‚ù§Ô∏è por:</h4>
            <p>Centro Pok√©mon feito pelos alunos da segunda fase de ci√™ncia da computa√ß√£o da Unoesc:<br>
            Alexandre Lampert, Gustavo Pigatto, Matheus Schavann, Felipe Winter, e Mateus Stock.</p>
        </div>

        <div class="sobre-decor">
            <img class="decor-item pokebola-animada" src="/imagens/pokebola.png" alt="Pok√©bola">
            <img class="decor-item greatball-animada" src="/imagens/pokebola.png" alt="Great Ball">
            <img class="decor-item ultraball-animada" src="/imagens/pokebola.png" alt="Ultra Ball">
            <img class="decor-item masterball-animada" src="/imagens/Bag_Master_Ball_SV_Sprite.png" alt="Master Ball">
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2024 Centro Pok√©mon. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- @scripts   JavaScript externo para anima√ß√µes -->
    <script src="/js/animacoes.js"></script>
    <script>
        const API_BASE_TREINADORES = '/api/treinadores';
        const TRAINER_ID_KEY = 'treinador_id';
        const trainerId = localStorage.getItem(TRAINER_ID_KEY);
        const pokemonSelect = document.getElementById('pokemon-select');
        const consultasGrid = document.getElementById('consultas-grid');
        const alertBox = document.getElementById('agendar-alert');

        function setAlert(type, text) {
            alertBox.className = 'alert';
            alertBox.textContent = '';
            if (!text) return;
            alertBox.classList.add(type);
            alertBox.textContent = text;
        }

        async function fetchJson(url, init) {
            const res = await fetch(url, init);
            if (!res.ok) throw new Error(String(res.status));
            return res.json();
        }

        let pokemonsList = [];

        async function carregarPokemons() {
            if (!trainerId) {
                pokemonSelect.innerHTML = '<option value="">Fa√ßa login para agendar</option>';
                pokemonSelect.disabled = true;
                setAlert('error', 'Fa√ßa login para agendar consultas.');
                return;
            }
            const lista = await fetchJson(`${API_BASE_TREINADORES}/${trainerId}/pokemons`);
            pokemonsList = lista;
            pokemonSelect.innerHTML = '';
            for (const p of lista) {
                const opt = document.createElement('option');
                opt.value = String(p.id);
                opt.textContent = `${p.nomePt} (#${p.pokeApiId || p.id})`;
                pokemonSelect.appendChild(opt);
            }
            renderCuraRapida(lista);
        }

        function renderCuraRapida(pokemons) {
            const grid = document.getElementById('pokemon-cura-grid');
            if (!grid) return;
            if (!pokemons || pokemons.length === 0) {
                grid.innerHTML = '<div class="empty" style="color: white;">Voc√™ ainda n√£o tem Pok√©mon cadastrados.</div>';
                return;
            }
            grid.innerHTML = '';
            for (const p of pokemons) {
                const card = document.createElement('div');
                card.className = 'pokemon-cura-card';
                const hpPercent = Math.round((p.vidaAtual / p.vidaMaxima) * 100);
                const isCurado = hpPercent === 100;
                card.innerHTML = `
                    <img class="pokemon-cura-sprite" src="${p.spriteUrl}" alt="${p.nomePt}" onerror="this.src='/imagens/pokebola.png'" />
                    <div class="pokemon-cura-nome">${p.nomePt}</div>
                    <div class="hp-bar-container" data-pokemon-id="${p.id}" onclick="curarPokemon(${p.id})">
                        <div class="hp-bar-fill" style="width: ${hpPercent}%"></div>
                        <div class="hp-text">${p.vidaAtual}/${p.vidaMaxima} HP</div>
                    </div>
                    ${isCurado ? '<div class="curado-badge">‚úì Curado</div>' : ''}
                `;
                grid.appendChild(card);
            }
        }

        async function curarPokemon(pokemonId) {
            if (!trainerId) return;
            try {
                await fetchJson(`${API_BASE_TREINADORES}/${trainerId}/pokemons/${pokemonId}/curar`, { method: 'POST' });
                await carregarPokemons();
            } catch (err) {
                console.error('Erro ao curar:', err);
            }
        }

        function renderConsultas(consultas) {
            consultasGrid.innerHTML = '';
            if (!consultas || consultas.length === 0) {
                consultasGrid.innerHTML = '<div class="empty">Nenhuma consulta agendada.</div>';
                return;
            }
            for (const c of consultas) {
                const card = document.createElement('div');
                card.className = 'consulta-card';
                const dt = new Date(c.dataHora);
                const dia = String(dt.getDate()).padStart(2, '0');
                const mes = String(dt.getMonth() + 1).padStart(2, '0');
                const hora = String(dt.getHours()).padStart(2, '0');
                const min = String(dt.getMinutes()).padStart(2, '0');
                const dataFormatada = `${dia}/${mes}`;
                const horaFormatada = `${hora}:${min}`;
                const tipoMap = {'CONSULTA':'Consulta','VACINACAO':'Vacina√ß√£o','CHECKUP':'Check-up'};
                const tipoTraduzido = tipoMap[c.tipo] || c.tipo;
                card.innerHTML = `
                    <div class="consulta-sprite">
                        <img src="${c.pokemonSpriteUrl}" alt="${c.pokemonNome}" onerror="this.src='/imagens/pokebola.png'" />
                    </div>
                    <div class="consulta-info">
                        <div class="consulta-titulo">${c.pokemonNome}, ${tipoTraduzido}</div>
                        <div class="consulta-data-hora">
                            <span class="data-badge">üìÖ ${dataFormatada}</span>
                            <span class="hora-badge">üïê ${horaFormatada}</span>
                        </div>
                        ${c.observacoes ? `<div class="consulta-obs">üí¨ ${c.observacoes}</div>` : ''}
                    </div>
                `;
                consultasGrid.appendChild(card);
            }
        }

        async function carregarConsultas() {
            if (!trainerId) return;
            const lista = await fetchJson(`${API_BASE_TREINADORES}/${trainerId}/consultas`);
            renderConsultas(lista);
        }

        async function handleAgendar(e) {
            e.preventDefault();
            if (!trainerId) {
                setAlert('error', 'Fa√ßa login para agendar consultas.');
                return;
            }
            const pokemonId = Number(pokemonSelect.value);
            const tipo = document.getElementById('tipo-consulta').value;
            const dataHoraStr = document.getElementById('datahora-consulta').value;
            const observacoes = document.getElementById('obs-consulta').value;
            if (!pokemonId || !tipo || !dataHoraStr) {
                setAlert('error', 'Preencha Pok√©mon, Tipo e Data/Hora.');
                return;
            }
            const dataHora = new Date(dataHoraStr);
            if (dataHora < new Date()) {
                setAlert('error', 'A data da consulta n√£o pode estar no passado.');
                return;
            }
            const body = { pokemonId, tipo, dataHora: dataHoraStr, observacoes };
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            try {
                await fetchJson(`${API_BASE_TREINADORES}/${trainerId}/consultas`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)
                });
                setAlert('success', '‚úÖ Consulta agendada com sucesso!');
                document.getElementById('tipo-consulta').value = 'CONSULTA';
                document.getElementById('datahora-consulta').value = '';
                document.getElementById('obs-consulta').value = '';
                await carregarConsultas();
            } catch (err) {
                const msg = String(err.message || '');
                if (msg === '404') setAlert('error', 'Pok√©mon n√£o encontrado.');
                else if (msg === '409') setAlert('error', 'J√° existe uma consulta agendada para este hor√°rio.');
                else setAlert('error', 'N√£o foi poss√≠vel agendar. Tente novamente.');
            } finally {
                submitBtn.disabled = false;
            }
        }

        document.getElementById('agendar-consulta-form').addEventListener('submit', handleAgendar);
        carregarPokemons().then(carregarConsultas).catch(() => {});
    </script>
</body>
</html>
